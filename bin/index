#!/usr/bin/env node

const program = require('commander')
const path = require('path')
const useAssetsLoader = require('../lib/useAssetsLoader.js')

program
  .option('--config <path>', 'the path to config file', String)
  .option('--watch', 'watch files')
  .parse(process.argv)

const { patterns, ...settings } = require(path.resolve(program.config))

if (!Array.isArray(patterns)) {
  console.log('"patterns" option is missing:')
  return program.help()
}

const { exportJson, watch } = useAssetsLoader(patterns, settings, { projectRoot: process.env.INIT_CWD })

exportJson()
console.log('PhaserAssets: Initialized')
if (program.watch) {
  console.log('PhaserAssets: Watching...')
  watch(() => {
    console.log('PhaserAssets: Reloaded')
  })
}
